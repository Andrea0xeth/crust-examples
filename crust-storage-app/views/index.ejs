<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crust Storage on Algorand</title>
  <!-- Add meta name for Pera Wallet app name -->
  <meta name="name" content="Crust Storage App" />
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/style.css">
  
  <!-- Load axios before wallet libraries -->
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

  <!-- Bundle script with Pera Wallet directly from source -->
  <script src="https://cdn.jsdelivr.net/npm/@perawallet/connect@2.1.0/dist/index.umd.min.js"></script>
</head>
<body>
  <div class="container">
    <header class="text-center my-4">
      <h1>Crust Storage on Algorand</h1>
      <p class="lead">Connect your wallet, upload a file, and store it on IPFS via Crust</p>
    </header>

    <div class="row justify-content-center">
      <div class="col-md-8">
        <div class="card shadow mb-4">
          <div class="card-header bg-primary text-white">
            <h3 class="card-title mb-0">Connect Wallet</h3>
          </div>
          <div class="card-body">
            <div id="wallet-connect-section">
              <p>Connect to your Algorand wallet to start uploading files.</p>
              <button id="connect-wallet-btn" class="btn btn-primary">Connect with Pera Wallet</button>
              <div id="wallet-status" class="mt-3 d-none">
                <div class="alert alert-success">
                  <strong>Connected!</strong>
                  <p id="wallet-address"></p>
                </div>
              </div>
              <!-- Debug information section -->
              <div id="debug-info" class="mt-3">
                <small class="text-muted">If you're having trouble connecting, please check the browser console (F12) for more information.</small>
                <% if (walletConnectProjectId) { %>
                  <div class="alert alert-info mt-2">
                    <strong>WalletConnect Project ID is configured</strong>
                  </div>
                <% } else { %>
                  <div class="alert alert-warning mt-2">
                    <strong>WalletConnect Project ID is not configured!</strong> This might cause connection issues.
                  </div>
                <% } %>
              </div>
            </div>
          </div>
        </div>

        <div class="card shadow mb-4">
          <div class="card-header bg-success text-white">
            <h3 class="card-title mb-0">Upload File to IPFS</h3>
          </div>
          <div class="card-body">
            <div id="upload-section">
              <p>Select a file to upload (max size: 1 MB)</p>
              <form id="upload-form" enctype="multipart/form-data">
                <div class="mb-3">
                  <input type="file" class="form-control" id="file-input" required>
                </div>
                <div class="form-check mb-3">
                  <input class="form-check-input" type="checkbox" id="is-permanent">
                  <label class="form-check-label" for="is-permanent">
                    Permanent Storage (5x price)
                  </label>
                </div>
                <button type="submit" class="btn btn-success" id="upload-btn" disabled>Upload to IPFS</button>
              </form>
              <div id="upload-progress" class="progress mt-3 d-none">
                <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"></div>
              </div>
              <div id="upload-result" class="mt-3 d-none">
                <div class="alert alert-info">
                  <h4>File Uploaded Successfully</h4>
                  <p><strong>CID:</strong> <span id="file-cid"></span></p>
                  <p><strong>Size:</strong> <span id="file-size"></span> bytes</p>
                  <p><strong>Storage Price:</strong> <span id="storage-price"></span> microALGO (<span id="storage-price-algos"></span> ALGO)</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="card shadow mb-4">
          <div class="card-header bg-warning text-dark">
            <h3 class="card-title mb-0">Place Storage Order</h3>
          </div>
          <div class="card-body">
            <div id="order-section">
              <p>After uploading a file, place a storage order to store it on the Crust network</p>
              <button id="place-order-btn" class="btn btn-warning" disabled>Place Storage Order</button>
              <div id="order-result" class="mt-3 d-none">
                <div class="alert alert-success">
                  <h4>Order Placed Successfully!</h4>
                  <p>Your file has been submitted for storage on the Crust network.</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Pass environment variables to frontend -->
  <script>
    window.APP_CONFIG = {
      walletConnectProjectId: "<%= walletConnectProjectId %>", 
      storageAppId: <%= storageAppId %> 
    };
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/js/app.js"></script>
  
  <!-- Basic connection status check -->
  <script>
    window.addEventListener('load', function() {
      console.log('Window loaded');
      console.log('PeraWalletConnect available:', typeof PeraWalletConnect !== 'undefined');
      console.log('WalletConnect project ID:', window.APP_CONFIG.walletConnectProjectId);
    });
  </script>
</body>
</html> 